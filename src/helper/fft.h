#pragma once
#include <stdint.h>

// ---------------------------------------------------------------------------
// fft_int — 128-точечный FFT на целых числах (Q15, radix-2 DIT Cooley-Tukey)
//
// Вход:  re[128] — вещественная часть (Q15, диапазон -32768..32767)
//        im[128] — мнимая часть (обычно нули для вещественного сигнала)
// После вызова re/im содержат комплексный спектр.
// Масштаб: каждая ступень делит на 2 (7 ступеней → /128).
//   При входном сигнале ±A, пик спектра ≈ A/2.
//
// Магнитуды (bins 0..63):
//   FFT_Magnitude(re, im, mag, 64)  →  mag[k] ≈ sqrt(re[k]^2+im[k]^2)
//   (используется быстрое приближение без корня)
// ---------------------------------------------------------------------------

// Выполнить 128-точечный FFT in-place.
// re, im — массивы 128 элементов int16_t.
void FFT_128(int16_t *re, int16_t *im);

// Вычислить магнитуды bins[0..count-1] из комплексного спектра.
// mag[k] = (3/4)*max(|re|,|im|) + (1/4)*min(|re|,|im|)  (≈0.97 точность)
// Результат в те же единицы, что и вход FFT.
void FFT_Magnitude(const int16_t *re, const int16_t *im,
                   uint16_t *mag, int count);
